!function(){"use strict";angular.module("wu.masonry",[]).controller("MasonryCtrl",function(a,b,c){function i(a){a.addClass("loaded")}var d={},e=[],f=!1,g=this,h=null;this.preserveOrder=!1,this.loadImages=!0,this.scheduleMasonryOnce=function(){var a=arguments,b=e.filter(function(b){return b[0]===a[0]}).length>0;b||this.scheduleMasonry.apply(null,arguments)},this.scheduleMasonry=function(){h&&c.cancel(h),e.push([].slice.call(arguments)),h=c(function(){f||(e.forEach(function(a){b.masonry.apply(b,a)}),e=[])},30)},this.appendBrick=function(a,c){function e(){0===Object.keys(d).length&&b.masonry("resize"),void 0===d[c]&&(d[c]=!0,i(a),b.masonry("appended",a,!0))}function h(){g.scheduleMasonryOnce("layout")}f||(g.loadImages?g.preserveOrder?(e(),a.imagesLoaded(h)):a.imagesLoaded(function(){e(),h()}):(e(),h()))},this.removeBrick=function(a,c){f||(delete d[a],b.masonry("remove",c),this.scheduleMasonryOnce("layout"))},this.destroy=function(){f=!0,b.data("masonry")&&b.masonry("destroy"),a.$emit("masonry.destroyed"),d={}},this.reload=function(){b.masonry(),a.$emit("masonry.reloaded")}}).directive("masonry",function(){return{restrict:"AE",controller:"MasonryCtrl",link:{pre:function(a,b,c,d){var e=a.$eval(c.masonry||c.masonryOptions),f=angular.extend({itemSelector:c.itemSelector||".masonry-brick",columnWidth:parseInt(c.columnWidth,10)||c.columnWidth},e||{});b.masonry(f);var g=a.$eval(c.loadImages);d.loadImages=g!==!1;var h=a.$eval(c.preserveOrder);d.preserveOrder=h!==!1&&void 0!==c.preserveOrder;var i=a.$eval(c.reloadOnShow);i!==!1&&void 0!==c.reloadOnShow&&a.$watch(function(){return b.prop("offsetParent")},function(a,b){a&&!b&&d.reload()}),a.$emit("masonry.created",b),a.$on("$destroy",d.destroy)}}}}).directive("masonryBrick",function(){return{restrict:"AC",require:"^masonry",scope:!0,link:{pre:function(a,b,c,d){var f,e=a.$id;d.appendBrick(b,e),b.on("$destroy",function(){d.removeBrick(e,b)}),a.$on("masonry.reload",function(){d.scheduleMasonryOnce("reloadItems"),d.scheduleMasonryOnce("layout")}),a.$watch("$index",function(){void 0!==f&&f!==a.$index&&(d.scheduleMasonryOnce("reloadItems"),d.scheduleMasonryOnce("layout")),f=a.$index})}}}})}();